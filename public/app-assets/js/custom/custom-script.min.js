
$(document).ready(function () {

    /**
     * Début d'initialisation des champs'
     */

    cancer()
    suite()
    cardiopathie()
    wedge()
    lobectomie()
    conversion()
    usc()
    chimio_post()
    radio_post()
    recidive()
    deces()
    chimio_pre()
    reponse()
    immune()
    paraneo()
    rcp_ryth()
    tabagisme()

    calculeImc()
    calculeDureeHospi()
    calculedureeSuivi()
    calculeAge()



    if ($("#form_patient_chir_geste").val() !== "Autre"){
        $('#form_patient_autre_chir_geste').attr('disabled','disabled')
        $('#form_patient_autre_chir_geste').val('')
    }

    if ($("#form_patient_chir_abord").val() !== "thoracoscopie"){
        $('#divAbord').hide()
       $('#form_patient_chir_thoracos').val('')
    }

    if ($("#form_patient_histo_pre_op").val() !== "Autre"){
        $('#form_patient_autre_histo_pre_op').attr('disabled','disabled')
        $('#form_patient_autre_histo_pre_op').val('')
    }

    if ($("#form_patient_mode_obt_his_pre_ope").val() !== "Autre"){
        $('#form_patient_autre_mode_obt_his_pre_ope').attr('disabled','disabled')
        $('#form_patient_autre_mode_obt_his_pre_ope').val('')
    }

    if ($("#form_patient_cons_neu_dep_mg_pre_op").val() !== "Autre"){
        $('#form_patient_autre_cons_neu_dep_mg_pre_op').attr('disabled','disabled')
        $('#form_patient_autre_cons_neu_dep_mg_pre_op').val('')
    }

    if ($("#form_patient_trai_fond_myasthenie").val() !== "Autre"){
        $('#form_patient_autre_trai_fond_myasthenie').attr('disabled','disabled')
        $('#form_patient_autre_trai_fond_myasthenie').val('')
    }

    if ($("#form_patient_tdm").val() !== "Oui"){
        $('#form_patient_autre_tdm').attr('disabled','disabled')
        $('#form_patient_autre_tdm').val('')
    }

    if ($("#form_patient_petscan").val() !== "Oui"){
        $('#form_patient_autre_petscan').attr('disabled','disabled')
        $('#form_patient_autre_petscan').val('')
    }

    if ($("#form_patient_tnm_t").val() !== "Autre"){
        $('#form_patient_autre_tnm_t').attr('disabled','disabled')
        $('#form_patient_autre_tnm_t').val('')
    }

    if ($("#form_patient_tnm_n").val() !== "Autre"){
        $('#form_patient_autre_tnm_n').attr('disabled','disabled')
        $('#form_patient_autre_tnm_n').val('')
    }

    if ($("#form_patient_tnm_m").val() !== "Autre"){
        $('#form_patient_autre_tnm_m').attr('disabled','disabled')
        $('#form_patient_autre_tnm_m').val('')
    }

    if ($("#form_patient_tnm_stade_ctnm").val() !== "Autre"){
        $('#form_patient_autre_stade').attr('disabled','disabled')
        $('#form_patient_autre_stade').val('')
    }

    if ($("#form_patient_post_tnm_t").val() !== "Autre"){
        $('#form_patient_autre_post_tnm_t').attr('disabled','disabled')
        $('#form_patient_autre_post_tnm_t').val('')
    }

    if ($("#form_patient_anapath_post_op").val() !== "Autre"){
        $('#form_patient_autre_anapath_post_op').attr('disabled','disabled')
        $('#form_patient_autre_anapath_post_op').val('')
    }

    if ($("#form_patient_post_tnm_n").val() !== "Autre"){
        $('#form_patient_autre_post_tnm_n').attr('disabled','disabled')
        $('#form_patient_autre_post_tnm_n').val('')
    }

    if ($("#form_patient_post_tnm_m").val() !== "Autre"){
        $('#form_patient_autre_post_tnm_m').attr('disabled','disabled')
        $('#form_patient_autre_post_tnm_m').val('')
    }

    if ($("#form_patient_post_tnm_stade_ctnm").val() !== "Autre"){
        $('#form_patient_autre_post_tnm_stade_ctnm').attr('disabled','disabled')
        $('#form_patient_autre_post_tnm_stade_ctnm').val('')
    }

    if ($("#form_patient_chirurgien_referent").val() !== "Autre"){
        $('#form_patient_autre_chirurgien_referent').attr('disabled','disabled')
        $('#form_patient_autre_chirurgien_referent').val('')
    }

    /**
     * Fin d'initialisation des champs'
     */



    /**
     * Début des calculs
     */

    $('#form_patient_poids').on('change',function ($) {
       calculeImc()
   })

    $('#form_patient_taille').on('change',function ($) {
        calculeImc()
    })

    $('#form_patient_chir_date_ope').on('change',function ($) {
        calculeDureeHospi()
        calculedureeSuivi()
    })

    $('#form_patient_post_op_date_sortie').on('change',function ($) {
        calculeDureeHospi()
    })

    $('#form_patient_date_der_nouvelles').on('change',function ($) {
        calculedureeSuivi()
    })

    $('#form_patient_ddn').on('change',function ($) {
        calculeAge()
    })

    $("#form_patient_cancer").on('change',function () {
         cancer()
    })

    $("#form_patient_cardiopathie").on('change',function () {
        cardiopathie()
    })

    $("#form_patient_tabagisme").on('change',function () {
        tabagisme()
    })

    $("#form_patient_wedge").on('change',function () {
        wedge()
    })

    $("#form_patient_lobectomie").on('change',function () {
        lobectomie()
    })

    $("#conversion").on('change',function () {
        conversion()
    })

    $("#suite").on('change',function () {
        suite()
    })

    $("#usc").on('change',function () {
        usc()
    })

    $("#chimio_post_op").on('change',function () {
        chimio_post()
    })

    $("#radio_post_op").on('change',function () {
        radio_post()
    })

    $("#recidive").on('change',function () {
        recidive()
    })

    $("#deces").on('change',function () {
        deces()
    })

    $("#chimiopreop").on('change',function () {
        chimio_pre()
    })

    $("#reponse").on('change',function () {
        reponse()
    })

    $("#immune").on('change',function () {
        immune()
    })

    $("#paraneo").on('change',function () {
        paraneo()
    })

    $("#rcp_ryth").on('change',function () {
        rcp_ryth()
    })


    /**
     * Fin des calculs
     */



    /**
     * Début traitement particuliére
     */

    $('textarea#form_patient_radiotherapie_post_op, textarea#form_patient_chimio_post_op,' +
        ' textarea#form_patient_suivi_myasthenie, textarea#form_patient_localisation_recidive, textarea#form_patient_traitement_rechute_recidive,' +
        ' textarea#form_patient_cause_deces, input#form_patient_num_acp').characterCounter();

    /**
     * Fin traitement particuliére
     */

})


function tpOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_post_tnm_t').removeAttr('disabled')
        $('#form_patient_autre_post_tnm_t').focus()
    }else{
        $('#form_patient_autre_post_tnm_t').attr('disabled','disabled')
        $('#form_patient_autre_post_tnm_t').val('')
    }
}

function npOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_post_tnm_n').removeAttr('disabled')
        $('#form_patient_autre_post_tnm_n').focus()
    }else{
        $('#form_patient_autre_post_tnm_n').attr('disabled','disabled')
        $('#form_patient_autre_post_tnm_n').val('')
    }
}

function mpOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_post_tnm_m').removeAttr('disabled')
        $('#form_patient_autre_post_tnm_m').focus()
    }else{
        $('#form_patient_autre_post_tnm_m').attr('disabled','disabled')
        $('#form_patient_autre_post_tnm_m').val('')
    }
}

function stadepOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_post_tnm_stade_ctnm').removeAttr('disabled')
        $('#form_patient_autre_post_tnm_stade_ctnm').focus()
    }else{
        $('#form_patient_autre_post_tnm_stade_ctnm').attr('disabled','disabled')
        $('#form_patient_autre_post_tnm_stade_ctnm').val('')
    }
}

function histopOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_anapath_post_op').removeAttr('disabled')
        $('#form_patient_autre_anapath_post_op').focus()
    }else{
        $('#form_patient_autre_anapath_post_op').attr('disabled','disabled')
        $('#form_patient_autre_anapath_post_op').val('')
    }
}

function gesteOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_chir_geste').removeAttr('disabled')
        $('#form_patient_autre_chir_geste').focus()
    }else{
        $('#form_patient_autre_chir_geste').attr('disabled','disabled')
        $('#form_patient_autre_chir_geste').val('')
    }
}

function abordOnChange(event) {
    console.log(document.getElementById("form_patient_chir_thoracos").disabled)
    if ($(event.target).val() === "thoracoscopie"){
        $('#divAbord').show()
    }else{
        $('#form_patient_chir_thoracos').val('')
        $('#divAbord').hide()
    }
}

function tOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_tnm_t').removeAttr('disabled')
        $('#form_patient_autre_tnm_t').focus()
    }else{
        $('#form_patient_autre_tnm_t').attr('disabled','disabled')
        $('#form_patient_autre_tnm_t').val('')
    }
}

function nOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_tnm_n').removeAttr('disabled')
        $('#form_patient_autre_tnm_n').focus()
    }else{
        $('#form_patient_autre_tnm_n').attr('disabled','disabled')
        $('#form_patient_autre_tnm_n').val('')
    }
}

function mOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_tnm_m').removeAttr('disabled')
        $('#form_patient_autre_tnm_m').focus()
    }else{
        $('#form_patient_autre_tnm_m').attr('disabled','disabled')
        $('#form_patient_autre_tnm_m').val('')
    }
}

function stadeOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_stade').removeAttr('disabled')
        $('#form_patient_autre_stade').focus()
    }else{
        $('#form_patient_autre_stade').attr('disabled','disabled')
        $('#form_patient_autre_stade').val('')
    }
}

function tdmOnChange(event) {
    if ($(event.target).val() === "Oui"){
        $('#form_patient_autre_tdm').removeAttr('disabled')
        $('#form_patient_autre_tdm').focus()
    }else{
        $('#form_patient_autre_tdm').attr('disabled','disabled')
        $('#form_patient_autre_tdm').val('')
    }
}

function petscanOnChange(event) {
    if ($(event.target).val() === "Oui"){
        $('#form_patient_autre_petscan').removeAttr('disabled')
        $('#form_patient_autre_petscan').focus()
    }else{
        $('#form_patient_autre_petscan').attr('disabled','disabled')
        $('#form_patient_autre_petscan').val('')
    }
}

function consNeuOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_cons_neu_dep_mg_pre_op').removeAttr('disabled')
        $('#form_patient_autre_cons_neu_dep_mg_pre_op').focus()
    }else{
        $('#form_patient_autre_cons_neu_dep_mg_pre_op').attr('disabled','disabled')
    }
}

function traiFondOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_trai_fond_myasthenie').removeAttr('disabled')
        $('#form_patient_autre_trai_fond_myasthenie').focus()
    }else{
        $('#form_patient_autre_trai_fond_myasthenie').attr('disabled','disabled')
    }
}

function histoOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_histo_pre_op').removeAttr('disabled')
        $('#form_patient_autre_histo_pre_op').focus()
    }else{
        $('#form_patient_autre_histo_pre_op').attr('disabled','disabled')
    }
}

function modeHistoOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_mode_obt_his_pre_ope').removeAttr('disabled')
        $('#form_patient_autre_mode_obt_his_pre_ope').focus()
    }else{
        $('#form_patient_autre_mode_obt_his_pre_ope').attr('disabled','disabled')
    }
}

function chirOnChange(event) {
    if ($(event.target).val() === "Autre"){
        $('#form_patient_autre_chirurgien_referent').removeAttr('disabled')
        $('#form_patient_autre_chirurgien_referent').focus()
    }else{
        $('#form_patient_autre_chirurgien_referent').val('')
        $('#form_patient_autre_chirurgien_referent').attr('disabled','disabled')
    }
}

function cancer() {
    var checkBox = document.getElementById("form_patient_cancer");
    if (checkBox.checked){
        $('#cancer').removeAttr('disabled')
        $('#cancer').focus()
    }else{
        $('#cancer').val('')
        $('#cancer').attr('disabled','disabled')
    }
}

function chimio_post() {
    var checkBox = document.getElementById("chimio_post_op");
    if (checkBox.checked){
        $('#form_patient_chimio_post_op').removeAttr('disabled')
        $('#form_patient_chimio_post_op').focus()
    }else{
        $('#form_patient_chimio_post_op').attr('disabled','disabled')
    }
}

function radio_post() {
    var checkBox = document.getElementById("radio_post_op");
    if (checkBox.checked){
        $('#form_patient_radiotherapie_post_op').removeAttr('disabled')
        $('#form_patient_radiotherapie_post_op').focus()
    }else{
        $('#form_patient_radiotherapie_post_op').attr('disabled','disabled')
    }
}

function conversion() {
    var checkBox = document.getElementById("conversion");
    if (checkBox.checked){
        $('#form_patient_conversion').removeAttr('disabled')
        $('#form_patient_conversion').focus()
    }else{
        $('#form_patient_conversion').attr('disabled','disabled')
    }
}

function lobectomie() {
    var checkBox = document.getElementById("form_patient_lobectomie");
    if (checkBox.checked){
        $('#form_patient_lobectomie_txt').removeAttr('disabled')
        $('#form_patient_lobectomie_txt').focus()
    }else{
        $('#form_patient_lobectomie_txt').attr('disabled','disabled')
    }
}

function wedge() {
    var checkBox = document.getElementById("form_patient_wedge");
    if (checkBox.checked){
        $('#form_patient_wedge_txt').removeAttr('disabled')
        $('#form_patient_wedge_txt').focus()
    }else{
        $('#form_patient_wedge_txt').attr('disabled','disabled')
    }
}

function cardiopathie() {
    var checkBox = document.getElementById("form_patient_cardiopathie");
    if (checkBox.checked){
        $('#cardiopathie').removeAttr('disabled')
        $('#cardiopathie').focus()
    }else{
        $('#cardiopathie').val('')
        $('#cardiopathie').attr('disabled','disabled')
    }
}

function usc() {
    var checkBox = document.getElementById("usc");
    if (checkBox.checked){
        $('#form_patient_rea_usc_post_op').removeAttr('disabled')
        $('#form_patient_rea_usc_post_op').focus()
    }else{
        $('#form_patient_rea_usc_post_op').attr('disabled','disabled')
    }
}

function suite() {
    var checkBox = document.getElementById("suite");
    if (checkBox.checked){
        $('#div_suite').show()
    }else{
        $('#div_suite').hide()
    }
}

function recidive() {
    var checkBox = document.getElementById("recidive");
    if (checkBox.checked){
        $('#view-input-fields_10').show()
    }else{
        $('#view-input-fields_10').hide()
    }
}

function deces() {
    var checkBox = document.getElementById("deces");
    if (checkBox.checked){
        $('#cause_deces').show()
        $('#cause_deces').focus()
    }else{
        $('#cause_deces').val('')
        $('#cause_deces').hide()
    }
}

function chimio_pre() {
    var checkBox = document.getElementById("chimiopreop");
    if (checkBox.checked){
        $('#form_patient_chimio_pre_op').removeAttr('disabled')
        $('#form_patient_chimio_pre_op').focus()
        $('#divreponse').show()
    }else{
        $('#form_patient_chimio_pre_op').val('')
        $('#form_patient_chimio_pre_op').attr('disabled','disabled')
        $('#divreponse').hide()
    }
}

function reponse() {
    var checkBox = document.getElementById("reponse");
    if (checkBox.checked){
        $('#form_patient_reponse_chimio_pre_op').show()
        $('#form_patient_reponse_chimio_pre_op').focus()
    }else{
        $('#form_patient_reponse_chimio_pre_op').val('')
        $('#form_patient_reponse_chimio_pre_op').hide()
    }
}

function immune() {
    var checkBox = document.getElementById("immune");
    if (checkBox.checked){
        $('#form_patient_maladi_auto_imm_assoc').removeAttr('disabled')
        $('#form_patient_maladi_auto_imm_assoc').focus()
    }else{
        $('#form_patient_maladi_auto_imm_assoc').val('')
        $('#form_patient_maladi_auto_imm_assoc').attr('disabled','disabled')
    }
}

function paraneo() {
    var checkBox = document.getElementById("paraneo");
    if (checkBox.checked){
        $('#form_patient_syndrome_paraneo').removeAttr('disabled')
        $('#form_patient_syndrome_paraneo').focus()
    }else{
        $('#form_patient_syndrome_paraneo').val('')
        $('#form_patient_syndrome_paraneo').attr('disabled','disabled')
    }
}

function  rcp_ryth() {
    var checkBox = document.getElementById("rcp_ryth");
    if (checkBox.checked){
        $('#form_patient_rcp_rythmique').removeAttr('disabled')
        $('#form_patient_rcp_rythmique').focus()
    }else{
        $('#form_patient_rcp_rythmique').val('')
        $('#form_patient_rcp_rythmique').attr('disabled','disabled')
    }
}

function tabagisme() {
    var checkBox = document.getElementById("form_patient_tabagisme");
    if (checkBox.checked){
        $('#tabagisme').removeAttr('disabled')
        $('#tabagisme').focus()
    }else{
        $('#tabagisme').val('')
        $('#tabagisme').attr('disabled','disabled')
    }
}

function calculeAge() {

    if ($('#form_patient_ddn').val()){
        var d = new Date();
        var ddn = new Date($('#form_patient_ddn').val())
        var y = d.getFullYear();
        var yn = ddn.getFullYear();
        var rslt = y - yn
        $('#form_patient_age').val(rslt)
    }else{
        $('#form_patient_age').val(0)
    }
}

function calculeImc() {
    if ($('#form_patient_taille').val()){
        var rst = $('#form_patient_poids').val() /( ($('#form_patient_taille').val()/100) *  ($('#form_patient_taille').val()/100) )

        if (rst.toFixed(2) >= 18.5 && rst.toFixed(2) <= 25 ){
            $('#form_patient_imc').css({
                'color': 'green'
            })
        }

        if (rst.toFixed(2) > 25 && rst.toFixed(2) <= 35 ){
            $('#form_patient_imc').css({
                'color': 'orange'
            })
        }

        if (rst.toFixed(2) < 18.5 || rst.toFixed(2) > 35 ){
            $('#form_patient_imc').css({
                'color': 'red'
            })
        }


        $('#form_patient_imc').val(rst.toFixed(2))
    }else{
        $('#form_patient_imc').val(0)
    }
}

function calculeDureeHospi() {

    if ($('#form_patient_chir_date_ope').val()){

    }

    if ($('#form_patient_post_op_date_sortie').val()){
        $('#form_patient_chir_date_ope').attr('max',$('#form_patient_post_op_date_sortie').val())
    }

    if ($('#form_patient_chir_date_ope').val() && $('#form_patient_post_op_date_sortie').val()){
        // To set two dates to two variables
        var date1 = new Date($('#form_patient_chir_date_ope').val());
        var date2 = new Date($('#form_patient_post_op_date_sortie').val());
        var Difference = (date2 - date1)/86400000;
        $('#duree_hopi').val(Difference)
    }else{
        $('#duree_hopi').val(0)
    }
}

function calculedureeSuivi() {

    if ($('#form_patient_chir_date_ope').val()){
        $('#form_patient_date_der_nouvelles').attr('min',$('#form_patient_chir_date_ope').val())
    }

    if ($('#form_patient_date_der_nouvelles').val()){
        $('#form_patient_chir_date_ope').attr('max',$('#form_patient_date_der_nouvelles').val())
    }

    if ($('#form_patient_chir_date_ope').val() && $('#form_patient_date_der_nouvelles').val()){
        // To set two dates to two variables
        var date1 = new Date($('#form_patient_chir_date_ope').val());
        var date2 = new Date($('#form_patient_date_der_nouvelles').val());
        var Difference = (date2 - date1)/86400000;
        $('#suivi_jour').val(Difference)
    }else{
        $('#suivi_jour').val(0)
    }
}



function deleteUser (id) {
    iziToast.question({
        timeout: false,
        close: false,
        overlay: true,
        displayMode: 'once',
        id: 'question',
        zindex: 999,
        title: 'Confirmation:',
        message: 'Êtes-vous sûr de vouloir supprimer ce patient ?',
        position: 'center',
        buttons: [
            ['<button><b>OUI</b></button>', function (instance, toast) {
                // Make a request for a user with a given ID
                axios.get('/formulaire/'+id)
                    .then(function (response) {
                     //   alert(response.data)
                        $(location).attr("href", "/");
                    })
                    .catch(function (error) {
                        // handle error
                        iziToast.error({
                            timeout: 20000,
                            title: 'Error',
                            message: ''+error,
                        });
                        console.log(error);
                    })
                    .finally(function () {
                        // always executed
                    });
                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');
            }, true],
            ['<button>NON</button>', function (instance, toast) {
                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');
            }]
        ],
        onClosing: function(instance, toast, closedBy){
            console.info('Closing | closedBy: ' + closedBy);
        },
        onClosed: function(instance, toast, closedBy){
            console.info('Closed | closedBy: ' + closedBy);
        }
    });
}



